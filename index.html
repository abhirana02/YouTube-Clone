<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube Clone</title>
  <style>
    :root{
      --bg:#0f0f0f;
      --elev:#151515;
      --text:#f1f1f1;
      --muted:#aaa;
      --chip:#272727;
      --accent:#3ea6ff;
      --border:#2a2a2a;
      --danger:#ff4d4f;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg); color:var(--text);
    }
    /* Header */
    header{
      position:sticky; top:0; z-index:1000; display:grid; grid-template-columns:auto 1fr auto; gap:12px; align-items:center;
      padding:10px 16px; background:var(--bg); border-bottom:1px solid var(--border);
    }
    .left{display:flex; gap:12px; align-items:center}
    .icon-btn{
      width:40px; height:40px; border-radius:999px; display:grid; place-items:center; border:1px solid var(--border);
      background:transparent; color:var(--text); cursor:pointer; transition:background .2s,border-color .2s;
    }
    .icon-btn:hover{background:var(--elev); border-color:#3a3a3a}
    .logo{font-weight:800; letter-spacing:.2px; display:flex; align-items:center; gap:6px}
    .logo .dot{width:10px;height:10px;border-radius:50%;background:#ff0033;display:inline-block}

    /* Search */
    .search-wrap{display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center}
    .search{display:flex; width:100%;}
    .search input{
      flex:1; height:40px; border:1px solid var(--border); background:#121212; color:var(--text);
      padding:0 14px; border-radius:20px 0 0 20px; outline:none;
    }
    .search button{
      height:40px; min-width:64px; border:1px solid var(--border); border-left:none; border-radius:0 20px 20px 0; background:var(--elev); color:var(--text); cursor:pointer;
    }
    .mic{width:40px;height:40px;border-radius:999px;border:1px solid var(--border);background:var(--elev);}

    .right{display:flex; gap:10px; align-items:center}
    .avatar{width:32px;height:32px;border-radius:50%;background:#333}

    /* Layout */
    .layout{display:grid; grid-template-columns:240px 1fr; min-height:calc(100vh - 60px)}
    aside{
      position:sticky; top:60px; height:calc(100vh - 60px); overflow:auto; border-right:1px solid var(--border); background:var(--bg);
    }
    .nav{padding:8px}
    .nav a{
      display:flex; gap:12px; align-items:center; padding:10px 12px; border-radius:12px; color:var(--text); text-decoration:none;
    }
    .nav a:hover{background:var(--elev)}

    main{padding:16px}
    .chips{display:flex; gap:8px; overflow:auto; padding:4px 0 12px}
    .chip{background:var(--chip); color:#e6e6e6; padding:8px 12px; border-radius:999px; white-space:nowrap; cursor:pointer; border:1px solid var(--border)}
    .chip.active{background:#fff; color:#111}

    /* Video grid */
    .grid{
      display:grid; gap:16px; grid-template-columns:repeat(4,minmax(0,1fr));
    }
    @media (max-width: 1300px){.grid{grid-template-columns:repeat(3,minmax(0,1fr));}}
    @media (max-width: 900px){.layout{grid-template-columns:56px 1fr} aside{width:56px} .nav .label{display:none} .grid{grid-template-columns:repeat(2,minmax(0,1fr));}}
    @media (max-width: 600px){header{grid-template-columns: auto 1fr auto} .grid{grid-template-columns:1fr}}

    .card{display:flex; flex-direction:column; gap:8px}
    .thumb{position:relative; border-radius:12px; overflow:hidden; aspect-ratio:16/9; background:#1a1a1a; border:1px solid var(--border)}
    .thumb img{width:100%; height:100%; object-fit:cover; display:block}
    .duration{position:absolute; right:6px; bottom:6px; background:rgba(0,0,0,.8); color:#fff; font-size:12px; padding:2px 6px; border-radius:6px}
    .meta{display:grid; grid-template-columns:auto 1fr; gap:10px}
    .meta .ch{width:36px;height:36px;border-radius:50%;background:#222;border:1px solid var(--border);object-fit:cover}
    .title{font-weight:600; line-height:1.3; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden}
    .muted{color:var(--muted); font-size:13px}

    /* Skeletons */
    .skeleton{animation:pulse 1.2s infinite; background:#1a1a1a;}
    @keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}

    /* Player modal */
    .modal{position:fixed; inset:0; background:rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; padding:20px}
    .modal.show{display:flex}
    .player{width:min(100%, 1200px);}
    .player iframe{width:100%; aspect-ratio:16/9; border:none; border-radius:12px}
    .player-info{margin-top:12px; display:flex; flex-direction:column; gap:6px}

    /* Toast */
    .toast{position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#222; color:#fff; padding:10px 14px; border-radius:8px; border:1px solid var(--border); display:none}
    .toast.show{display:block}

    /* Hide scrollbar for aesthetics */
    ::-webkit-scrollbar{height:10px; width:10px}
    ::-webkit-scrollbar-thumb{background:#333; border-radius:10px}
    ::-webkit-scrollbar-track{background:#111}
  </style>
</head>
<body>
  <header>
    <div class="left">
      <button class="icon-btn" id="toggleSidebar" title="Menu">‚ò∞</button>
      <div class="logo" title="YouTube Clone"><span class="dot"></span><span>YouTube</span></div>
    </div>
    <div class="search-wrap">
      <form id="searchForm" class="search" autocomplete="off">
        <input id="searchInput" placeholder="Search" />
        <button type="submit">üîç</button>
      </form>
      <button class="mic" title="Voice search (mock)">üé§</button>
    </div>
    <div class="right">
      <button class="icon-btn" id="themeBtn" title="Theme">üåì</button>
      <div class="avatar" title="Profile"></div>
    </div>
  </header>

  <div class="layout">
    <aside>
      <nav class="nav">
        <a href="#" data-chip="All">üè† <span class="label">Home</span></a>
        <a href="#" data-chip="Music">üéµ <span class="label">Music</span></a>
        <a href="#" data-chip="Gaming">üéÆ <span class="label">Gaming</span></a>
        <a href="#" data-chip="News">üì∞ <span class="label">News</span></a>
        <a href="#" data-chip="Sports">üèÖ <span class="label">Sports</span></a>
      </nav>
    </aside>

    <main>
      <div class="chips" id="chips"></div>
      <section class="grid" id="grid" aria-live="polite"></section>
      <div id="sentinel" style="height:1px"></div>
    </main>
  </div>

  <div class="modal" id="modal">
    <div class="player">
      <div id="playerSlot"></div>
      <div class="player-info">
        <div id="playerTitle" class="title"></div>
        <div id="playerMeta" class="muted"></div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ===================== CONFIG =====================
    const API_KEY = "AIzaSyDfEHrvLVTkcDFdCAd1RaSHCA3bx5-pRsY"; // Consider restricting this key by HTTP referrer in Google Cloud Console.
    const API_BASE = "https://www.googleapis.com/youtube/v3";
    const REGION = "IN";

    // ===================== STATE =====================
    let mode = "home"; // 'home' | 'search'
    let nextPageToken = null;
    let currentQuery = "";
    let fetching = false;

    const grid = document.getElementById('grid');
    const chipsEl = document.getElementById('chips');
    const modal = document.getElementById('modal');
    const playerSlot = document.getElementById('playerSlot');
    const playerTitle = document.getElementById('playerTitle');
    const playerMeta = document.getElementById('playerMeta');

    const defaultChips = ["All","Music","Gaming","Live","News","Learning","Sports","Comedy","Cars","Science","Trailers"];    

    // ===================== UI HELPERS =====================
    function toast(msg){
      const t = document.getElementById('toast');
      t.textContent = msg; t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'), 2000);
    }
    function numberFmt(n){
      n = Number(n||0);
      if(n>=1_000_000_000) return (n/1_000_000_000).toFixed(1).replace(/\.0$/,'')+"B";
      if(n>=1_000_000) return (n/1_000_000).toFixed(1).replace(/\.0$/,'')+"M";
      if(n>=1_000) return (n/1_000).toFixed(1).replace(/\.0$/,'')+"K";
      return n.toString();
    }
    function timeAgo(iso){
      const then = new Date(iso).getTime();
      const diff = Math.max(0, Date.now()-then);
      const units = [
        [365*24*3600*1000,'year'],
        [30*24*3600*1000,'month'],
        [7*24*3600*1000,'week'],
        [24*3600*1000,'day'],
        [3600*1000,'hour'],
        [60*1000,'minute'],
      ];
      for(const [ms,label] of units){
        const v = Math.floor(diff/ms);
        if(v>=1) return `${v} ${label}${v>1?'s':''} ago`;
      }
      return 'just now';
    }

    function createSkeletonCard(){
      const card = document.createElement('article'); card.className='card';
      card.innerHTML = `
        <div class="thumb skeleton"></div>
        <div class="meta">
          <div class="ch skeleton"></div>
          <div>
            <div class="skeleton" style="height:16px; border-radius:6px; margin:4px 0; width:90%"></div>
            <div class="skeleton" style="height:12px; border-radius:6px; margin:4px 0; width:70%"></div>
          </div>
        </div>`;
      return card;
    }

    function renderCard(v){
      const vid = v.id?.videoId || v.id; // search vs videos list
      const sn = v.snippet;
      const stats = v.statistics || {};
      const chThumb = v._channelThumb || 'https://i.imgur.com/8Km9tLL.png';
      const duration = v.contentDetails?.duration ? isoDurationToClock(v.contentDetails.duration) : '';

      const card = document.createElement('article'); card.className='card'; card.dataset.vid=vid;
      card.innerHTML = `
        <div class="thumb">
          <img loading="lazy" src="https://i.ytimg.com/vi/${vid}/hqdefault.jpg" alt="${escapeHtml(sn.title)} thumbnail"/>
          ${duration ? `<span class="duration">${duration}</span>`: ''}
        </div>
        <div class="meta">
          <img class="ch" src="${chThumb}" alt="${escapeHtml(sn.channelTitle)}"/>
          <div>
            <div class="title">${escapeHtml(sn.title)}</div>
            <div class="muted">${escapeHtml(sn.channelTitle)}</div>
            <div class="muted">${stats.viewCount? numberFmt(stats.viewCount)+ ' views ¬∑ ': ''}${timeAgo(sn.publishedAt)}</div>
          </div>
        </div>`;

      card.addEventListener('click',()=>openPlayer(vid, sn.title, sn.channelTitle, stats.viewCount));
      return card;
    }

    function escapeHtml(s){
      return (s||'').replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[c]));
    }

    function isoDurationToClock(iso){
      // Minimal ISO 8601 duration -> hh:mm:ss
      const m = iso.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
      if(!m) return '';
      let [_,H,M,S] = m; H=+H||0; M=+M||0; S=+S||0;
      const parts=[H,M,S].map((x,i)=> i===0? x.toString():String(x).padStart(2,'0'));
      while(parts.length>1 && parts[0]===0) parts.shift();
      return parts.length===1? `0:${String(parts[0]).padStart(2,'0')}`: parts.join(':');
    }

    // ===================== API CALLS =====================
    async function yt(endpoint, params){
      const url = new URL(API_BASE + '/' + endpoint);
      params.key = API_KEY;
      Object.entries(params).forEach(([k,v])=> url.searchParams.set(k,v));
      const res = await fetch(url);
      if(!res.ok){
        let msg = `HTTP ${res.status}`;
        try{ const j = await res.json(); msg = j.error?.message || msg; }catch{}
        throw new Error(msg);
      }
      return res.json();
    }

    async function fetchHome(pageToken){
      const data = await yt('videos', { part:'snippet,statistics,contentDetails', chart:'mostPopular', regionCode:REGION, maxResults:24, pageToken: pageToken||'' });
      nextPageToken = data.nextPageToken || null;
      const items = data.items;
      // fetch channel thumbs in batch
      const channelIds = [...new Set(items.map(i=> i.snippet.channelId))].join(',');
      if(channelIds){
        const ch = await yt('channels',{ part:'snippet', id: channelIds, maxResults:50 });
        const map = new Map(ch.items.map(c=> [c.id, c.snippet.thumbnails?.default?.url || '']));
        items.forEach(i=> i._channelThumb = map.get(i.snippet.channelId));
      }
      return items;
    }

    async function fetchSearch(q, pageToken){
      const data = await yt('search', { part:'snippet', q, type:'video', maxResults:24, regionCode:REGION, pageToken: pageToken||'' });
      nextPageToken = data.nextPageToken || null;
      const items = data.items.map(i=> ({ id:i.id.videoId, snippet:i.snippet }));
      // enrich with stats + duration
      const ids = items.map(i=> i.id).join(',');
      if(ids){
        const v = await yt('videos', { part:'statistics,contentDetails', id: ids });
        const map = new Map(v.items.map(x=> [x.id, x]));
        items.forEach(i=> {
          const m = map.get(i.id);
          if(m){ i.statistics = m.statistics; i.contentDetails = m.contentDetails; }
        });
      }
      // channel thumbs
      const channelIds = [...new Set(items.map(i=> i.snippet.channelId))].join(',');
      if(channelIds){
        const ch = await yt('channels',{ part:'snippet', id: channelIds, maxResults:50 });
        const map = new Map(ch.items.map(c=> [c.id, c.snippet.thumbnails?.default?.url || '']));
        items.forEach(i=> i._channelThumb = map.get(i.snippet.channelId));
      }
      return items;
    }

    // ===================== RENDERING =====================
    function addSkeletons(count=12){
      const frag = document.createDocumentFragment();
      for(let i=0;i<count;i++) frag.appendChild(createSkeletonCard());
      grid.appendChild(frag);
    }
    function clearGrid(){ grid.innerHTML=''; }

    async function loadMore(){
      if(fetching) return; fetching = true;
      addSkeletons(8);
      try{
        const items = mode==='home' ? await fetchHome(nextPageToken) : await fetchSearch(currentQuery, nextPageToken);
        // remove last N skeletons
        [...grid.querySelectorAll('.skeleton')].forEach(s=> s.parentElement?.parentElement?.remove());
        const frag = document.createDocumentFragment();
        items.forEach(v=> frag.appendChild(renderCard(v)));
        grid.appendChild(frag);
      }catch(err){
        console.error(err); toast('Error: '+err.message);
      }finally{
        fetching = false;
      }
    }

    function resetAndLoadHome(){
      mode='home'; nextPageToken=null; currentQuery=''; clearGrid(); loadMore();
      setActiveChip('All');
    }

    // ===================== SEARCH + CHIPS =====================
    function buildChips(){
      chipsEl.innerHTML = '';
      const frag = document.createDocumentFragment();
      defaultChips.forEach(text=>{
        const el = document.createElement('button'); el.className='chip'; el.textContent=text;
        el.addEventListener('click', ()=>{
          if(text==='All'){ resetAndLoadHome(); return; }
          startSearch(text);
        });
        frag.appendChild(el);
      });
      chipsEl.appendChild(frag);
      setActiveChip('All');
    }

    function setActiveChip(label){
      [...chipsEl.querySelectorAll('.chip')].forEach(c=> c.classList.toggle('active', c.textContent===label));
    }

    function startSearch(q){
      mode='search'; nextPageToken=null; currentQuery=q; clearGrid(); setActiveChip(q);
      loadMore();
    }

    document.getElementById('searchForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const q = document.getElementById('searchInput').value.trim();
      if(!q) return;
      startSearch(q);
    });

    // ===================== PLAYER =====================
    function openPlayer(vid, title, channelTitle, views){
      modal.classList.add('show');
      document.body.style.overflow='hidden';
      playerSlot.innerHTML = `<iframe src="https://www.youtube.com/embed/${vid}?autoplay=1" allowfullscreen allow="autoplay; encrypted-media"></iframe>`;
      playerTitle.textContent = title || '';
      playerMeta.textContent = `${channelTitle || ''} ¬∑ ${views? numberFmt(views)+' views ¬∑ ': ''}`;
    }
    modal.addEventListener('click', (e)=>{
      if(e.target===modal){ closePlayer(); }
    });
    function closePlayer(){
      modal.classList.remove('show'); playerSlot.innerHTML=''; document.body.style.overflow='';
    }
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closePlayer(); });

    // ===================== SIDEBAR + THEME =====================
    document.getElementById('toggleSidebar').addEventListener('click', ()=>{
      const aside = document.querySelector('aside');
      aside.style.display = (aside.style.display==='none') ? 'block' : 'none';
    });

    document.getElementById('themeBtn').addEventListener('click', ()=>{
      const dark = document.documentElement.dataset.theme !== 'light';
      if(dark){
        document.documentElement.dataset.theme = 'light';
        Object.assign(document.documentElement.style, {
          '--bg':'#ffffff','--elev':'#f3f4f6','--text':'#0f172a','--muted':'#475569','--chip':'#e5e7eb','--border':'#e5e7eb'
        });
      } else {
        document.documentElement.dataset.theme = 'dark';
        Object.assign(document.documentElement.style, {
          '--bg':'#0f0f0f','--elev':'#151515','--text':'#f1f1f1','--muted':'#aaa','--chip':'#272727','--border':'#2a2a2a'
        });
      }
    });

    // ===================== INFINITE SCROLL =====================
    const io = new IntersectionObserver((entries)=>{
      for(const entry of entries){
        if(entry.isIntersecting && nextPageToken){ loadMore(); }
      }
    });
    io.observe(document.getElementById('sentinel'));

    // ===================== INIT =====================
    buildChips();
    resetAndLoadHome();
  </script>
</body>
</html